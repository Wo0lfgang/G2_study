import { __assign } from "tslib";
import { getFont, parseLength, getEllipsisText } from '../text';
import { select } from '../selection';
import { defined } from '../defined';
export function applyLabelStyle(shape, idx, attrs, style) {
    var datum = attrs[idx].data;
    var data = attrs.map(function (d) { return d.data; });
    var labelStyle = typeof style === 'function' ? style.call(null, datum, idx, data) : style;
    shape.attr(labelStyle || {});
}
export function limitText(textShape, maxLength) {
    var font = getFont(textShape);
    var limitLength = parseLength(maxLength, font);
    // @ts-ignore
    textShape.attr('tip', null);
    if (defined(limitLength) && limitLength < textShape.getBounds().halfExtents[0] * 2) {
        var ellipsis = getEllipsisText(textShape.style.text || '', limitLength, font, '...');
        // @ts-ignore
        textShape.attr('tip', textShape.style.text);
        textShape.attr('text', ellipsis);
    }
}
/**
 * Display labels by default.
 */
export function renderLabels(container, className, labels, cfg, defaultStyle) {
    if (defaultStyle === void 0) { defaultStyle = {}; }
    select(container)
        .selectAll(".".concat(className))
        .data(labels, function (d) { return d.id; })
        .join(function (enter) {
        return enter
            .append('text')
            .styles(__assign({ className: className, fontFamily: 'sans-serif', fontSize: 12, fontWeight: 'normal' }, defaultStyle))
            .each(function (datum, idx) {
            this.attr(datum);
            limitText(this, (cfg === null || cfg === void 0 ? void 0 : cfg.maxLength) || Number.MAX_SAFE_INTEGER);
            applyLabelStyle(this, idx, labels, cfg === null || cfg === void 0 ? void 0 : cfg.style);
        });
    }, function (update) {
        return update.each(function (datum, idx) {
            this.attr(datum);
            limitText(this, (cfg === null || cfg === void 0 ? void 0 : cfg.maxLength) || Number.MAX_SAFE_INTEGER);
            applyLabelStyle(this, idx, labels, cfg === null || cfg === void 0 ? void 0 : cfg.style);
        });
    }, function (exit) { return exit.remove(); });
}
//# sourceMappingURL=labels.js.map