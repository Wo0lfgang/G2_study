!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@antv/g-lite")):"function"==typeof define&&define.amd?define(["exports","@antv/g-lite"],r):r(((t="undefined"!=typeof globalThis?globalThis:t||self).G=t.G||{},t.G.CanvasPicker={}),t.window.G)}(this,(function(t,r){"use strict";function n(){n=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,i=Object.defineProperty||function(t,r,n){t[r]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function f(t,r,n){return Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{f({},"")}catch(t){f=function(t,r,n){return t[r]=n}}function s(t,r,n,e){var o=Object.create((r&&r.prototype instanceof p?r:p).prototype),a=new S(e||[]);return i(o,"_invoke",{value:b(t,n,a)}),o}function h(t,r,n){try{return{type:"normal",arg:t.call(r,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var l={};function p(){}function v(){}function y(){}var d={};f(d,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(E([])));m&&m!==r&&e.call(m,a)&&(d=m);var x=y.prototype=p.prototype=Object.create(d);function M(t){["next","throw","return"].forEach((function(r){f(t,r,(function(t){return this._invoke(r,t)}))}))}function P(t,r){function n(i,o,a,u){var c=h(t[i],t,o);if("throw"!==c.type){var f=c.arg,s=f.value;return s&&"object"==typeof s&&e.call(s,"__await")?r.resolve(s.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(s).then((function(t){f.value=t,a(f)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;i(this,"_invoke",{value:function(t,e){function i(){return new r((function(r,i){n(t,e,r,i)}))}return o=o?o.then(i,i):i()}})}function b(t,r,n){var e="suspendedStart";return function(i,o){if("executing"===e)throw Error("Generator is already running");if("completed"===e){if("throw"===i)throw o;return F()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=w(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===e)throw e="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);e="executing";var c=h(t,r,n);if("normal"===c.type){if(e=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(e="completed",n.method="throw",n.arg=c.arg)}}}function w(t,r){var n=r.method,e=t.iterator[n];if(void 0===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;var i=h(e,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,l;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function k(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function L(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function E(t){if(t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:F}}function F(){return{value:void 0,done:!0}}return v.prototype=y,i(x,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:v,configurable:!0}),v.displayName=f(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===v||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,f(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},M(P.prototype),f(P.prototype,u,(function(){return this})),t.AsyncIterator=P,t.async=function(r,n,e,i,o){void 0===o&&(o=Promise);var a=new P(s(r,n,e,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},M(x),f(x,c,"Generator"),f(x,a,(function(){return this})),f(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),n=[];for(var e in r)n.push(e);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},t.values=E,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,e){return a.type="throw",a.arg=t,r.next=n,e&&(r.method="next",r.arg=void 0),!!e}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(this.prev>=o.tryLoc){var u=e.call(o,"catchLoc"),c=e.call(o,"finallyLoc");if(u&&c){if(o.catchLoc>this.prev)return n(o.catchLoc,!0);if(o.finallyLoc>this.prev)return n(o.finallyLoc)}else if(u){if(o.catchLoc>this.prev)return n(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(o.finallyLoc>this.prev)return n(o.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(this.prev>=i.tryLoc&&e.call(i,"finallyLoc")&&i.finallyLoc>this.prev){var o=i;break}}o&&("break"===t||"continue"===t)&&r>=o.tryLoc&&o.finallyLoc>=r&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=r,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===t){var e=n.completion;if("throw"===e.type){var i=e.arg;L(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:E(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function e(t,r,n,e,i,o,a){try{var u=t[o](a),c=u.value}catch(t){return void n(t)}u.done?r(c):Promise.resolve(c).then(e,i)}function i(t,r){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},i(t,r)}function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=Array(r);r>n;n++)e[n]=t[n];return e}function a(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return o(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0;return function(){return t.length>e?{done:!1,value:t[e++]}:{done:!0}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u="undefined"!=typeof Float32Array?Float32Array:Array;function c(){var t=new u(3);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function f(t,r,n,e){return t[0]=r,t[1]=n,t[2]=e,t}Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});var s;s=c();!function(){var t,r=(t=new u(2),u!=Float32Array&&(t[0]=0,t[1]=0),t)}();var h,l=c(),p=c(),v=c(),y=(h=new u(16),u!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h),d=function(){function t(){var t=this;this.canvasConfig=void 0,this.pathGeneratorFactory=void 0,this.pointInPathPickerFactory=void 0,this.isHit=function(n,e,i,o,a){var u=t.pointInPathPickerFactory[n.nodeName];if(u){var c=function(t,r){var n=r[0],e=r[1],i=r[2],o=r[3],a=r[4],u=r[5],c=r[6],f=r[7],s=r[8],h=r[9],l=r[10],p=r[11],v=r[12],y=r[13],d=r[14],g=r[15],m=n*u-e*a,x=n*c-i*a,M=n*f-o*a,P=e*c-i*u,b=e*f-o*u,w=i*f-o*c,k=s*y-h*v,L=s*d-l*v,S=s*g-p*v,E=h*d-l*y,F=h*g-p*y,O=l*g-p*d,A=m*O-x*F+M*E+P*S-b*L+w*k;return A?(t[0]=(u*O-c*F+f*E)*(A=1/A),t[1]=(i*F-e*O-o*E)*A,t[2]=(y*w-d*b+g*P)*A,t[3]=(l*b-h*w-p*P)*A,t[4]=(c*S-a*O-f*L)*A,t[5]=(n*O-i*S+o*L)*A,t[6]=(d*M-v*w-g*x)*A,t[7]=(s*w-l*M+p*x)*A,t[8]=(a*F-u*S+f*k)*A,t[9]=(e*S-n*F-o*k)*A,t[10]=(v*b-y*M+g*m)*A,t[11]=(h*M-s*b-p*m)*A,t[12]=(u*L-a*E-c*k)*A,t[13]=(n*E-e*L+i*k)*A,t[14]=(y*x-v*P-d*m)*A,t[15]=(s*P-h*x+l*m)*A,t):null}(y,i),s=function(t,r,n){var e=r[0],i=r[1],o=r[2],a=n[3]*e+n[7]*i+n[11]*o+n[15];return t[0]=(n[0]*e+n[4]*i+n[8]*o+n[12])/(a=a||1),t[1]=(n[1]*e+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*e+n[6]*i+n[10]*o+n[14])/a,t}(p,f(v,e[0],e[1],0),c),h=n.getGeometryBounds().halfExtents,l=n.parsedStyle.anchor;if(s[0]+=(l&&l[0]||0)*h[0]*2,s[1]+=(l&&l[1]||0)*h[1]*2,u(n,new r.Point(s[0],s[1]),o,t.isPointInPath,a))return!0}return!1},this.isPointInPath=function(r,n,e){var i=r.offscreenCanvas.getOrCreateContext(t.canvasConfig.offscreenCanvas),o=t.pathGeneratorFactory[n.nodeName];return o&&(i.beginPath(),o(i,n.parsedStyle),i.closePath()),i.isPointInPath(e.x,e.y)}}var i=t.prototype;return i.apply=function(r,i){var o,a=this,u=r.renderingService,c=r.renderingContext,f=r.pathGeneratorFactory,s=r.pointInPathPickerFactory;this.canvasConfig=r.config,this.pathGeneratorFactory=f,this.pointInPathPickerFactory=s;var h=null===(o=c.root)||void 0===o?void 0:o.ownerDocument;u.hooks.pick.tapPromise(t.tag,function(){var t,r=(t=n().mark((function t(r){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a.pick(h,r,i));case 1:case"end":return t.stop()}}),t)})),function(){var r=this,n=arguments;return new Promise((function(i,o){var a=t.apply(r,n);function u(t){e(a,i,o,u,c,"next",t)}function c(t){e(a,i,o,u,c,"throw",t)}u(void 0)}))});return function(t){return r.apply(this,arguments)}}()),u.hooks.pickSync.tap(t.tag,(function(t){return a.pick(h,t,i)}))},i.pick=function(t,n,e){for(var i,o=n.topmost,u=n.position,c=f(l,u.x,u.y,0),s=[],h=a(t.elementsFromBBox(c[0],c[1],c[0],c[1]));!(i=h()).done;){var p=i.value,v=p.getWorldTransform();if(this.isHit(p,c,v,!1,e)){var y=r.findClosestClipPathTarget(p);if(y){var d=y.parsedStyle.clipPath;if(this.isHit(d,c,d.getWorldTransform(),!0,e)){if(o)return n.picked=[p],n;s.push(p)}}else{if(o)return n.picked=[p],n;s.push(p)}}}return n.picked=s,n},t}();function g(t,r,n,e){var i=t-n,o=r-e;return Math.sqrt(i*i+o*o)}function m(t,r){return.001>Math.abs(t-r)}function x(t,r){var n=Math.min.apply(Math,t),e=Math.min.apply(Math,r);return{x:n,y:e,width:Math.max.apply(Math,t)-n,height:Math.max.apply(Math,r)-e}}function M(t){return(t+2*Math.PI)%(2*Math.PI)}d.tag="CanvasPicker";var P=function(t,r,n,e,i){return{x:(1-i)*t+i*n,y:(1-i)*r+i*e}},b=function(t,r,n,e,i,o){var a=[n-t,e-r];if(function(t,r){return t[0]===r[0]&&t[1]===r[1]}(a,[0,0]))return Math.sqrt((i-t)*(i-t)+(o-r)*(o-r));var u=[-a[1],a[0]];return function(t,r){var n=r[0],e=r[1],i=n*n+e*e;i>0&&(i=1/Math.sqrt(i)),t[0]=r[0]*i,t[1]=r[1]*i}(u,u),Math.abs(function(t,r){return t[0]*r[0]+t[1]*r[1]}([i-t,o-r],u))};function w(t,r,n,e,i,o){var a=-1,u=1/0,c=[n,e],f=20;o&&o>200&&(f=o/10);for(var s=1/f,h=s/10,l=0;f>=l;l++){var p=l*s,v=[i.apply(void 0,t.concat([p])),i.apply(void 0,r.concat([p]))],y=g(c[0],c[1],v[0],v[1]);u>y&&(a=p,u=y)}if(0===a)return{x:t[0],y:r[0]};if(1===a){var d=t.length;return{x:t[d-1],y:r[d-1]}}u=1/0;for(var m=0;32>m&&1e-4<=h;m++){var x=a-h,M=a+h,P=[i.apply(void 0,t.concat([x])),i.apply(void 0,r.concat([x]))],b=g(c[0],c[1],P[0],P[1]);if(x>=0&&u>b)a=x,u=b;else{var w=[i.apply(void 0,t.concat([M])),i.apply(void 0,r.concat([M]))],k=g(c[0],c[1],w[0],w[1]);1>=M&&u>k?(a=M,u=k):h*=.5}}return{x:i.apply(void 0,t.concat([a])),y:i.apply(void 0,r.concat([a]))}}function k(t,r,n,e){var i=1-e;return i*i*t+2*e*i*r+e*e*n}function L(t,r,n){var e=t+n-2*r;if(m(e,0))return[.5];var i=(t-r)/e;return i>1||0>i?[]:[i]}function S(t,r,n,e){return 2*(1-e)*(r-t)+2*e*(n-r)}function E(t,r,n,e,i,o,a){var u=k(t,n,i,a),c=k(r,e,o,a),f=P(t,r,n,e,a),s=P(n,e,i,o,a);return[[t,r,f.x,f.y,u,c],[u,c,s.x,s.y,i,o]]}function F(t,r,n,e,i,o,a){if(0===a)return(g(t,r,n,e)+g(n,e,i,o)+g(t,r,i,o))/2;var u=E(t,r,n,e,i,o,.5),c=u[0],f=u[1];return c.push(a-1),f.push(a-1),F.apply(void 0,c)+F.apply(void 0,f)}var O={box:function(t,r,n,e,i,o){var a=L(t,n,i)[0],u=L(r,e,o)[0],c=[t,i],f=[r,o];return void 0!==a&&c.push(k(t,n,i,a)),void 0!==u&&f.push(k(r,e,o,u)),x(c,f)},length:function(t,r,n,e,i,o){return F(t,r,n,e,i,o,3)},nearestPoint:function(t,r,n,e,i,o,a,u){return w([t,n,i],[r,e,o],a,u,k)},pointDistance:function(t,r,n,e,i,o,a,u){var c=this.nearestPoint(t,r,n,e,i,o,a,u);return g(c.x,c.y,a,u)},interpolationAt:k,pointAt:function(t,r,n,e,i,o,a){return{x:k(t,n,i,a),y:k(r,e,o,a)}},divide:function(t,r,n,e,i,o,a){return E(t,r,n,e,i,o,a)},tangentAngle:function(t,r,n,e,i,o,a){var u=S(t,n,i,a),c=S(r,e,o,a);return M(Math.atan2(c,u))}};function A(t,r,n,e,i){var o=1-i;return o*o*o*t+3*r*i*o*o+3*n*i*i*o+e*i*i*i}function I(t,r,n,e,i){var o=1-i;return 3*(o*o*(r-t)+2*o*i*(n-r)+i*i*(e-n))}function T(t,r,n,e){var i,o,a,u=-3*t+9*r-9*n+3*e,c=6*t-12*r+6*n,f=3*r-3*t,s=[];if(m(u,0))m(c,0)||0>(i=-f/c)||i>1||s.push(i);else{var h=c*c-4*u*f;m(h,0)?s.push(-c/(2*u)):h>0&&(o=(-c-(a=Math.sqrt(h)))/(2*u),0>(i=(-c+a)/(2*u))||i>1||s.push(i),0>o||o>1||s.push(o))}return s}function j(t,r,n,e,i,o,a,u,c){var f=A(t,n,i,a,c),s=A(r,e,o,u,c),h=P(t,r,n,e,c),l=P(n,e,i,o,c),p=P(i,o,a,u,c),v=P(h.x,h.y,l.x,l.y,c),y=P(l.x,l.y,p.x,p.y,c);return[[t,r,h.x,h.y,v.x,v.y,f,s],[f,s,y.x,y.y,p.x,p.y,a,u]]}function _(t,r,n,e,i,o,a,u,c){if(0===c)return function(t,r){for(var n=0,e=t.length,i=0;e>i;i++)n+=g(t[i],r[i],t[(i+1)%e],r[(i+1)%e]);return n/2}([t,n,i,a],[r,e,o,u]);var f=j(t,r,n,e,i,o,a,u,.5),s=[].concat(f[0],[c-1]),h=[].concat(f[1],[c-1]);return _.apply(void 0,s)+_.apply(void 0,h)}var G={extrema:T,box:function(t,r,n,e,i,o,a,u){for(var c=[t,a],f=[r,u],s=T(t,n,i,a),h=T(r,e,o,u),l=0;s.length>l;l++)c.push(A(t,n,i,a,s[l]));for(var p=0;h.length>p;p++)f.push(A(r,e,o,u,h[p]));return x(c,f)},length:function(t,r,n,e,i,o,a,u){return _(t,r,n,e,i,o,a,u,3)},nearestPoint:function(t,r,n,e,i,o,a,u,c,f,s){return w([t,n,i,a],[r,e,o,u],c,f,A,s)},pointDistance:function(t,r,n,e,i,o,a,u,c,f,s){var h=this.nearestPoint(t,r,n,e,i,o,a,u,c,f,s);return g(h.x,h.y,c,f)},interpolationAt:A,pointAt:function(t,r,n,e,i,o,a,u,c){return{x:A(t,n,i,a,c),y:A(r,e,o,u,c)}},divide:function(t,r,n,e,i,o,a,u,c){return j(t,r,n,e,i,o,a,u,c)},tangentAngle:function(t,r,n,e,i,o,a,u,c){var f=I(t,n,i,a,c),s=I(r,e,o,u,c);return M(Math.atan2(s,f))}};function C(t,r,n,e){var i=t-n,o=r-e;return Math.sqrt(i*i+o*o)}function W(t,r,n,e,i,o){return!(t>i||i>t+n||r>o||o>r+e)}function H(t,r,n,e,i,o,a,u){var c=(Math.atan2(u-r,a-t)+2*Math.PI)%(2*Math.PI),f={x:t+n*Math.cos(c),y:r+n*Math.sin(c)};return C(f.x,f.y,a,u)<=o/2}function N(t,r,n,e,i,o,a){var u=i/2;return!(Math.min(t,n)-u>o||o>Math.max(t,n)+u||Math.min(r,e)-u>a||a>Math.max(r,e)+u)&&b(t,r,n,e,o,a)<=i/2}function q(t,r,n,e,i){var o=t.length;if(2>o)return!1;for(var a=0;o-1>a;a++){if(N(t[a][0],t[a][1],t[a+1][0],t[a+1][1],r,n,e))return!0}if(i){var u=t[0],c=t[o-1];if(N(u[0],u[1],c[0],c[1],r,n,e))return!0}return!1}function Y(t){return 1e-6>Math.abs(t)?0:0>t?-1:1}function D(t,r,n){return!((n[0]-t[0])*(r[1]-t[1])!=(r[0]-t[0])*(n[1]-t[1])||Math.min(t[0],r[0])>n[0]||n[0]>Math.max(t[0],r[0])||Math.min(t[1],r[1])>n[1]||n[1]>Math.max(t[1],r[1]))}function R(t,r,n){var e=!1,i=t.length;if(2>=i)return!1;for(var o=0;i>o;o++){var a=t[o],u=t[(o+1)%i];if(D(a,u,[r,n]))return!0;Y(a[1]-n)>0!=Y(u[1]-n)>0&&0>Y(r-(n-a[1])*(a[0]-u[0])/(a[1]-u[1])-a[0])&&(e=!e)}return e}function X(t,r,n){for(var e=!1,i=0;t.length>i;i++){if(e=R(t[i],r,n))break}return e}function B(t,n,e){var i=t.parsedStyle,o=i.r,a=i.fill,u=i.stroke,c=i.pointerEvents,f=((i.lineWidth||0)+(i.increasedLineWidthForHitTesting||0))/2,s=C(o,o,n.x,n.y),h=r.isFillOrStrokeAffected(c,a,u),l=h[0],p=h[1];return l&&p||e?o+f>=s:l?o>=s:!!p&&(s>=o-f&&o+f>=s)}function U(t,r,n,e){return t/(n*n)+r/(e*e)}function Q(t,n,e){var i=t.parsedStyle,o=i.rx,a=i.ry,u=i.lineWidth,c=i.increasedLineWidthForHitTesting,f=n.x,s=n.y,h=r.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),l=h[0],p=h[1],v=((u||0)+(c||0))/2,y=(f-o)*(f-o),d=(s-a)*(s-a);return l&&p||e?1>=U(y,d,o+v,a+v):l?1>=U(y,d,o,a):!!p&&(U(y,d,o-v,a-v)>=1&&1>=U(y,d,o+v,a+v))}function Z(t,n,e){var i=t.parsedStyle,o=i.x1,a=i.y1,u=i.x2,c=i.y2,f=i.lineWidth,s=i.increasedLineWidthForHitTesting,h=i.defX,l=void 0===h?0:h,p=i.defY,v=void 0===p?0:p;return!(!r.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke)[1]&&!e||!f)&&N(o,a,u,c,(f||0)+(s||0),n.x+l,n.y+v)}function $(t,r,n){return{x:t*Math.cos(n)-r*Math.sin(n),y:t*Math.sin(n)+r*Math.cos(n)}}function z(t,r,n,e,i,o,a,u,c,f){var s,h,l,p,v,y=t,d=r,g=n,m=e,x=u,M=c,P=120*Math.PI/180,b=Math.PI/180*(+i||0),w=[];if(f)h=f[0],l=f[1],p=f[2],v=f[3];else{d=(s=$(y,d,-b)).y;var k=((y=s.x)-(x=(s=$(x,M,-b)).x))/2,L=(d-(M=s.y))/2,S=k*k/(g*g)+L*L/(m*m);S>1&&(g*=S=Math.sqrt(S),m*=S);var E=g*g,F=m*m,O=(o===a?-1:1)*Math.sqrt(Math.abs((E*F-E*L*L-F*k*k)/(E*L*L+F*k*k)));p=O*g*L/m+(y+x)/2,h=Math.asin(((d-(v=O*-m*k/g+(d+M)/2))/m*1e9>>0)/1e9),l=Math.asin(((M-v)/m*1e9>>0)/1e9),0>(h=p>y?Math.PI-h:h)&&(h=2*Math.PI+h),0>(l=p>x?Math.PI-l:l)&&(l=2*Math.PI+l),a&&h>l&&(h-=2*Math.PI),!a&&l>h&&(l-=2*Math.PI)}var A=l-h;if(Math.abs(A)>P){var I=l,T=x,j=M;w=z(x=p+g*Math.cos(l=h+P*(a&&l>h?1:-1)),M=v+m*Math.sin(l),g,m,i,0,a,T,j,[l,I,p,v])}A=l-h;var _=Math.cos(h),G=Math.sin(h),C=Math.cos(l),W=Math.sin(l),H=Math.tan(A/4),N=4/3*g*H,q=4/3*m*H,Y=[y,d],D=[y+N*G,d-q*_],R=[x+N*W,M-q*C],X=[x,M];if(D[0]=2*Y[0]-D[0],D[1]=2*Y[1]-D[1],f)return D.concat(R,X,w);for(var B=[],U=0,Q=(w=D.concat(R,X,w)).length;Q>U;U+=1)B[U]=U%2?$(w[U-1],w[U],b).y:$(w[U],w[U+1],b).x;return B}function J(t,n,e,i,o){var a=t.parsedStyle,u=a.lineWidth,c=a.increasedLineWidthForHitTesting,f=a.defX,s=void 0===f?0:f,h=a.defY,l=void 0===h?0:h,p=a.path,v=p.segments,y=p.hasArc,d=p.polylines,g=p.polygons,m=r.isFillOrStrokeAffected(a.pointerEvents,(null==g?void 0:g.length)&&a.fill,a.stroke),x=m[0],M=m[1],P=r.getOrCalculatePathTotalLength(t),b=!1;return x||e?b=y?i(o,t,n):X(g,n.x+s,n.y+l)||X(d,n.x+s,n.y+l):((M||e)&&(b=function(t,r,n,e,i){for(var o=!1,a=r/2,u=0;t.length>u;u++){var c=t[u],f=c.currentPoint,s=c.params,h=c.prePoint,l=c.box;if(!l||W(l.x-a,l.y-a,l.width+r,l.height+r,n,e))switch(c.command){case"L":case"Z":if(o=N(h[0],h[1],f[0],f[1],r,n,e))return!0;break;case"Q":if(o=r/2>=O.pointDistance(h[0],h[1],s[1],s[2],s[3],s[4],n,e))return!0;break;case"C":if(o=r/2>=G.pointDistance(h[0],h[1],s[1],s[2],s[3],s[4],s[5],s[6],n,e,i))return!0;break;case"A":c.cubicParams||(c.cubicParams=z(h[0],h[1],s[1],s[2],s[3],s[4],s[5],s[6],s[7],void 0));for(var p=c.cubicParams,v=h,y=0;p.length>y;y+=6){var d=G.pointDistance(v[0],v[1],p[y],p[y+1],p[y+2],p[y+3],p[y+4],p[y+5],n,e,i);if(v=[p[y+4],p[y+5]],o=r/2>=d)return!0}}}return o}(v,(u||0)+(c||0),n.x+s,n.y+l,P)),b)}function K(t,n,e){var i=t.parsedStyle,o=i.lineWidth,a=i.increasedLineWidthForHitTesting,u=i.points,c=i.defX,f=void 0===c?0:c,s=i.defY,h=void 0===s?0:s,l=r.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),p=l[0],v=!1;return(l[1]||e)&&(v=q(u.points,(o||0)+(a||0),n.x+f,n.y+h,!0)),v||!p&&!e||(v=R(u.points,n.x+f,n.y+h)),v}function V(t,n,e){var i=t.parsedStyle,o=i.lineWidth,a=i.increasedLineWidthForHitTesting,u=i.points,c=i.defX,f=void 0===c?0:c,s=i.defY,h=void 0===s?0:s;return!(!r.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke)[1]&&!e||!o)&&q(u.points,(o||0)+(a||0),n.x+f,n.y+h,!1)}function tt(t,n,e,i,o){var a=t.parsedStyle,u=a.radius,c=a.lineWidth,f=a.increasedLineWidthForHitTesting,s=a.width,h=a.height,l=r.isFillOrStrokeAffected(a.pointerEvents,a.fill,a.stroke),p=l[0],v=l[1],y=(c||0)+(f||0);if(u&&u.some((function(t){return 0!==t}))){var d=!1;return(v||e)&&(d=function(t,r,n,e,i,o,a,u){var c=i[0],f=i[1],s=i[2],h=i[3];return N(t+c,r,t+n-f,r,o,a,u)||N(t+n,r+f,t+n,r+e-s,o,a,u)||N(t+n-s,r+e,t+h,r+e,o,a,u)||N(t,r+e-h,t,r+c,o,a,u)||H(t+n-f,r+f,f,0,0,o,a,u)||H(t+n-s,r+e-s,s,0,0,o,a,u)||H(t+h,r+e-h,h,0,0,o,a,u)||H(t+c,r+c,c,0,0,o,a,u)}(0,0,s,h,u.map((function(t){return r=t,n=0,e=Math.min(Math.abs(s)/2,Math.abs(h)/2),n>r?n:r>e?e:r;var r,n,e})),y,n.x,n.y)),d||!p&&!e||(d=i(o,t,n)),d}var g=y/2;return p&&v||e?W(0-g,0-g,s+g,h+g,n.x,n.y):p?W(0,0,s,h,n.x,n.y):!!v&&function(t,r,n,e,i,o,a){var u=i/2;return W(t-u,r-u,n,i,o,a)||W(t+n-u,r-u,i,e,o,a)||W(t+u,r+e-u,n,i,o,a)||W(t-u,r+u,i,e,o,a)}(0,0,s,h,y,n.x,n.y)}var rt=function(t){var n,e;function o(){for(var r,n=arguments.length,e=Array(n),i=0;n>i;i++)e[i]=arguments[i];return(r=t.call.apply(t,[this].concat(e))||this).name="canvas-picker",r}(n=o).prototype=Object.create((e=t).prototype),n.prototype.constructor=n,i(n,e);var a=o.prototype;return a.init=function(){var t,n=function(){return!0},e=((t={})[r.Shape.CIRCLE]=B,t[r.Shape.ELLIPSE]=Q,t[r.Shape.RECT]=tt,t[r.Shape.LINE]=Z,t[r.Shape.POLYLINE]=V,t[r.Shape.POLYGON]=K,t[r.Shape.PATH]=J,t[r.Shape.TEXT]=n,t[r.Shape.GROUP]=null,t[r.Shape.IMAGE]=n,t[r.Shape.HTML]=null,t[r.Shape.MESH]=null,t);this.context.pointInPathPickerFactory=e,this.addRenderingPlugin(new d)},a.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},o}(r.AbstractRendererPlugin);t.Plugin=rt,Object.defineProperty(t,"__esModule",{value:!0})}));
